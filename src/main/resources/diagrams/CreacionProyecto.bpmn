<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
  <message id="InfoOffer" name="InfoOffer"></message>
  <process id="CreacionProyecto" name="CreacionProyecto" isExecutable="true">
    <userTask id="usertask1" name="Cumplimentar solicitud" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow1" sourceRef="startevent1" targetRef="usertask1">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [DPMail]
			def subject = "Rellene la siguiente solicitud de proyecto"
			def body = """\
			Hola, a continuacion se adjunta un link desde el que puede rellenar la solicitud del proyecto, ademas debera de contestar al correo indicando los datos de la organizacion externa interesada en el proyecto siguiendo el siguiente formato:
			<br/>
			<--<br/>
			Organizacion:<br/>
			Email:<br/>
			Contacto:<br/>
			--><br/>
			<br/>
			El link con la direccion de la solicitud es el siguiente:<br/>	"""+URLSolicitud+"""\
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <userTask id="usertask2" name="Firmar solicitud" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow2" sourceRef="usertask1" targetRef="usertask2">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [GerenciaMail]
			def subject = "Firme la solicitud"
			def body = """\
			Hola, a continuacion se adjunta un link desde el que puede firmar la solicitud del proyecto
			<br/>
			El link con la direccion de la solicitud es el siguiente:<br/>	"""+URLSolicitud+"""\
			<br/>
			<br/>
			Muchas gracias por su tiempo."""
			execution.setVariable("tos",tos)
			execution.setVariable("subject", subject)
			execution.setVariable("body", body)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <userTask id="usertask3" name="Evaluar caracteristicas" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow3" sourceRef="usertask2" targetRef="usertask3">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [GerenciaMail];
def subject = "Evalue el proyecto";
def body ="""Hola, a continuacion se adjunta un link desde el que puede ver la solicitud del proyecto y evaluarlo para decidir si es valido o no para FIDETIA. Ademas debera de contestar este correo indicando si es valido o no el proyecto usando la siguiente estructura: 

Aceptado: Si/No 

El link con la direccion de la solicitud es el siguiente:
"""+URLSolicitud+"""

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway5" name="Â¿Proyecto aceptado?"></exclusiveGateway>
    <endEvent id="endevent1" name="End"></endEvent>
    <sequenceFlow id="flow14" name="No" sourceRef="exclusivegateway5" targetRef="endevent1">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Aceptado=="No"}]]></conditionExpression>
    </sequenceFlow>
    <userTask id="usertask7" name="Delegar revision" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
        <activiti:executionListener event="end" class="isaFoundry.processEngine.CopyDocumentTemplate"></activiti:executionListener>
        <activiti:executionListener event="start" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def docName = "ViabilityStudy";
execution.setVariable("Doc",docName);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow15" name="Si" sourceRef="exclusivegateway5" targetRef="usertask7">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [Gerencia-Mail];
def subject = "Seleccione el equipo de trabajo";
def body ="""Hola, a continuacion se adjunta un link desde el que puede ver la solicitud del proyecto y seleccionar el equipo de trabajo que lo realizara usando la siguiente estructura: 

Nombre del equipo de trabajo:
Correo del director del equipo de trabajo: 

El link con la direccion de la solicitud es el siguiente:
"""+URLSolicitud+"""

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Aceptado=="Si"}]]></conditionExpression>
    </sequenceFlow>
    <userTask id="usertask8" name="Designar persona" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
        <activiti:executionListener event="end" class="isaFoundry.processEngine.CopyDocument"></activiti:executionListener>
        <activiti:executionListener event="start" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def src = ProjectPath+"/ProjectApplication"
def dest = ProjectPath+"/Offer";
def docName = "Offer";
execution.setVariable("src",src);
execution.setVariable("dest",dest);
execution.setVariable("Doc",docName)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow16" sourceRef="usertask7" targetRef="usertask8">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [DETMail];
def subject = "Designe a una persona para evaluar los requisitos del proyecto";
def body ="""Hola, a continuacion se adjunta un link desde el que puede ver la solicitud del proyecto y seleccionar la persona encargada de evaluar los requisitos usando la siguiente estructura: 

Correo de la persona encargada de evaluar los requisitos:

El link con la direccion de la solicitud es el siguiente:
"""+URLSolicitud+"""

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <userTask id="usertask9" name="Evaluar requisitos" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow17" sourceRef="usertask8" targetRef="usertask9">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [Designee-Mail];
def subject = "Evalue los requisitos del proyecto proyecto";
def body ="""Hola, a continuacion se adjunta un link desde el que puede ver la solicitud del proyecto, ademas debe de realizar un estudio de viabilidad
para ello se le adjunta una plantilla de estudio de viabilidad que debe rellenar. Por ultimo debe contestar al correo usando la siguiente estructura para indicar si el proyecto
es viable o no: 

Viable: Si/No

Los datos de la empresa son los siguientes:
Nombre de la organizacion:"""+OE-Name+"""
Correo de la organizacion:"""+OE-Mail+"""
Nombre de la persona encargada:"""+OE-Responsable+"""

El link con la direccion de la solicitud es el siguiente:
"""+URLSolicitud+"""

El link con la plantilla del estudio de viabilidad es:
"""+URLViabilityStudy+"""

Si el estudio de viabilidad es positivo modifique el documento para generar la oferta que recibirÃ¡ la empresa:
"""+URLOffer+"""

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway6" name="Â¿Es viable?"></exclusiveGateway>
    <endEvent id="endevent2" name="End"></endEvent>
    <sequenceFlow id="flow21" name="No" sourceRef="exclusivegateway6" targetRef="endevent2">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Viable=="No"}]]></conditionExpression>
    </sequenceFlow>
    <userTask id="usertask12" name="Revisar oferta" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <userTask id="usertask13" name="Revisar BD de los clientes" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
        <activiti:executionListener event="end" class="isaFoundry.processEngine.CopyDocument"></activiti:executionListener>
        <activiti:executionListener event="start" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def src = ProjectPath+"/Offer"
def dest = ProjectPath+"/EspecificAgreement";
def docName="EspecificAgreement"
execution.setVariable("src",src);
execution.setVariable("dest",dest);
execution.setVariable("Doc",docName)]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </userTask>
    <exclusiveGateway id="exclusivegateway10" name="Â¿Es cliente?"></exclusiveGateway>
    <sequenceFlow id="flow29" sourceRef="usertask13" targetRef="exclusivegateway10"></sequenceFlow>
    <userTask id="usertask15" name="Elaborar convenio especifico" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <userTask id="usertask16" name="Firmar convenio especifico" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
        <activiti:executionListener event="end" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [OE-Mail];
def subject = "Copia convenio especifico";
def body ="""Hola, a continuacion se adjunta un link desde el que puede ver el convenio especifico firmado para 
la realizacion del proyecto: 

El link con el convenio especifico del proyecto es el siguiente:
"""+URLEspecificAgreement+"""

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow34" sourceRef="usertask15" targetRef="usertask16">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [Gerencia-Mail];
def subject = "Firme junto con la empresa el siguiente convenio especifico";
def body ="""Hola, la siguiente empresa tiene aceptada una oferta y desea llevarla a cabo: 

Nombre de la organizacion:"""+OE-Name+"""
Correo de la organizacion:"""+OE-Mail+"""
Nombre de la persona encargada:"""+OE-Responsable+"""

Para ello se ha elaborado el sigiuente convenio especifico, por favor concerte una cita con la empresa responsable
y firme el documento que se encuentra disponible en el siguiente enlace:

"""+URLEspecificAgreement+"""

Una vez firmado por favor responda al correo con siguiente formato:

Firmado: Si

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <userTask id="usertask17" name="Dar proyecto de alta" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow35" sourceRef="usertask16" targetRef="usertask17">
      <extensionElements>
        <activiti:executionListener event="take" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [RGFMail];
def subject = "De el proyecto de alta en la aplicacion";
def body ="""Hola, a continuacion se adjunta un link desde el que puede ver el convenio especifico firmado para realizacion de
un proyecto. Por favor de el proyecto de alta en la aplicacion de FIDETIA. Tras hacerlo responda al correo, indicando si lo ha 
realizado correctamente o no, con el siguiente formato:  

Dado de alta: Si/No

El link con la direccion del convenio especifico es el siguiente:
"""+URLEspecificAgreement+"""


Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <endEvent id="endevent3" name="End"></endEvent>
    <sequenceFlow id="flow36" sourceRef="usertask17" targetRef="endevent3"></sequenceFlow>
    <startEvent id="startevent1" name="Start">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.CreateDirectory"></activiti:executionListener>
        <activiti:executionListener event="end" class="isaFoundry.processEngine.CopyDocumentTemplate"></activiti:executionListener>
      </extensionElements>
    </startEvent>
    <exclusiveGateway id="exclusivegateway13" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow44" sourceRef="exclusivegateway10" targetRef="exclusivegateway13">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Client==True}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow45" sourceRef="exclusivegateway13" targetRef="usertask15">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [DP-Mail];
def subject = "Redacte el convenio especifico";
def body ="""Hola, la siguiente empresa tiene aceptada una oferta y desea llevarla a cabo: 

Nombre de la organizacion:"""+OE-Name+"""
Correo de la organizacion:"""+OE-Mail+"""
Nombre de la persona encargada:"""+OE-Responsable+"""

Para ello se necesita firmar el convenio especifico, por favor redacte el convenio especifico
editando el documento que se encuentra disponible en el siguiente enlace:

"""+URLEspecificAgreement+"""

Una vez redactado por favor responda al correo con siguiente formato:

Finalizado: Si

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <userTask id="usertask20" name="Informar de la aceptacion de proyecto" activiti:assignee="kermit">
      <extensionElements>
        <activiti:executionListener event="start" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow46" name="Si" sourceRef="exclusivegateway6" targetRef="usertask20">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [OE-Mail];
def subject = "Proyecto aceptado";
def body ="""Hola, FIDETIA le informa que su proyecto ha sido aceptado. En el link que viene a continuacion podra ver
una estimacion inicial del proyecto. Tanto si desea negociar el precio del proyecto como si no, responda este correo con la siguiente estructura:

Negociar oferta: Si/No

El link con la oferta inicial es el siguiente:
"""+URLOffer+"""

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Viable=="Si"}]]></conditionExpression>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway14" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow49" sourceRef="exclusivegateway14" targetRef="usertask12">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [GerenciaMail];
def subject = "Revisar oferta del proyecto";
def body ="Hola, la organizacion """+OE-Name+""" quiere revisar la oferta inicial hecha por FIDETIA,a continuacion se adjunta 
un link desde el que puede ver la oferta del proyecto. Los datos de la empresa se muestran a continuacion:

Nombre de la organizacion:"""+OE-Name+"""
Correo de la organizacion:"""+OE-Mail+"""
Nombre de la persona encargada:"""+OE-Responsable+"""

Pongase en contacto con la organizacion y negocien un acuerdo para realizar el proyecto. Una vez que se haya fijado el precio
modificar la oferta.

El link con la direccion de la oferta es el siguiente:
"""+URLOffer+"""

Por ultimo responda al mail indicando si se ha llegado a un acuerdo o no, con el siguiente formato:

Acuerdo: Si/No

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Offer==True}]]></conditionExpression>
    </sequenceFlow>
    <exclusiveGateway id="exclusivegateway15" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow51" sourceRef="exclusivegateway15" targetRef="usertask13">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [Gerencia-Mail];
def subject = "Revise el convenio marco de la empresa";
def body ="""Hola, la siguiente empresa tiene aceptada una oferta y desea llevarla a cabo: 

Nombre de la organizacion:"""+OE-Name+"""
Correo de la organizacion:"""+OE-Mail+"""
Nombre de la persona encargada:"""+OE-Responsable+"""

Indique si la empresa tiene ya firmado el convenio marco con FIDETIA o no respondiendo al correo con la siguiente estructura:

Convenio Marco: Si/No

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow52" sourceRef="exclusivegateway14" targetRef="exclusivegateway15">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Offer==False}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow53" sourceRef="usertask3" targetRef="exclusivegateway5"></sequenceFlow>
    <sequenceFlow id="flow54" sourceRef="usertask9" targetRef="exclusivegateway6"></sequenceFlow>
    <sequenceFlow id="flow55" sourceRef="usertask20" targetRef="exclusivegateway14"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway16" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="flow56" sourceRef="usertask12" targetRef="exclusivegateway16">
      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[def tos = [OE-Mail];
def subject = "Oferta final del proyecto";
def body ="""Hola, a continuacion se adjunta un link desde el que puede ver la oferta final del proyecto: 

El link con la direccion de la oferta del proyecto es el siguiente:
"""+URLOffer+"""

Muchas gracias por su tiempo.""";
execution.setVariable("tos",tos);
execution.setVariable("subject", subject);
execution.setVariable("body", body);]]></activiti:string>
          </activiti:field>
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
    </sequenceFlow>
    <sequenceFlow id="flow57" sourceRef="exclusivegateway16" targetRef="exclusivegateway15">
      <extensionElements>
        <activiti:executionListener event="take" class="isaFoundry.processEngine.SendMail"></activiti:executionListener>
      </extensionElements>
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Continue==True}]]></conditionExpression>
    </sequenceFlow>
    <endEvent id="endevent4" name="End"></endEvent>
    <sequenceFlow id="flow58" sourceRef="exclusivegateway16" targetRef="endevent4">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Continue==False}]]></conditionExpression>
    </sequenceFlow>
    <callActivity id="callactivity1" name="Convenio Marco" activiti:exclusive="false">
      <extensionElements>
        <activiti:in source="OE-Mail" target="OE-Mail"></activiti:in>
        <activiti:in source="OE-Name" target="OE-Name"></activiti:in>
        <activiti:in source="OE-Responsable" target="OE-Responsable"></activiti:in>
        <activiti:in source="RGET-Mail" target="RGET-Mail"></activiti:in>
        <activiti:in source="Grenecia-Mail" target="Grenecia-Mail"></activiti:in>
      </extensionElements>
    </callActivity>
    <sequenceFlow id="flow59" sourceRef="exclusivegateway10" targetRef="callactivity1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${Client==False}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow60" sourceRef="callactivity1" targetRef="exclusivegateway13"></sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_CreacionProyecto">
    <bpmndi:BPMNPlane bpmnElement="CreacionProyecto" id="BPMNPlane_CreacionProyecto">
      <bpmndi:BPMNShape bpmnElement="usertask1" id="BPMNShape_usertask1">
        <omgdc:Bounds height="61.0" width="105.0" x="210.0" y="179.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask2" id="BPMNShape_usertask2">
        <omgdc:Bounds height="55.0" width="105.0" x="365.0" y="180.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask3" id="BPMNShape_usertask3">
        <omgdc:Bounds height="65.0" width="116.0" x="550.0" y="177.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway5" id="BPMNShape_exclusivegateway5">
        <omgdc:Bounds height="40.0" width="40.0" x="750.0" y="189.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="753.0" y="280.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask7" id="BPMNShape_usertask7">
        <omgdc:Bounds height="55.0" width="105.0" x="850.0" y="180.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask8" id="BPMNShape_usertask8">
        <omgdc:Bounds height="55.0" width="105.0" x="995.0" y="180.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask9" id="BPMNShape_usertask9">
        <omgdc:Bounds height="55.0" width="105.0" x="1155.0" y="180.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway6" id="BPMNShape_exclusivegateway6">
        <omgdc:Bounds height="40.0" width="40.0" x="1362.0" y="187.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent2" id="BPMNShape_endevent2">
        <omgdc:Bounds height="35.0" width="35.0" x="1365.0" y="292.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask12" id="BPMNShape_usertask12">
        <omgdc:Bounds height="55.0" width="105.0" x="1820.0" y="110.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask13" id="BPMNShape_usertask13">
        <omgdc:Bounds height="64.0" width="105.0" x="2180.0" y="174.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway10" id="BPMNShape_exclusivegateway10">
        <omgdc:Bounds height="40.0" width="40.0" x="2340.0" y="185.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask15" id="BPMNShape_usertask15">
        <omgdc:Bounds height="62.0" width="105.0" x="2820.0" y="174.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask16" id="BPMNShape_usertask16">
        <omgdc:Bounds height="62.0" width="105.0" x="2970.0" y="174.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask17" id="BPMNShape_usertask17">
        <omgdc:Bounds height="55.0" width="105.0" x="3120.0" y="177.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent3" id="BPMNShape_endevent3">
        <omgdc:Bounds height="35.0" width="35.0" x="3300.0" y="187.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="120.0" y="192.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway13" id="BPMNShape_exclusivegateway13">
        <omgdc:Bounds height="40.0" width="40.0" x="2726.0" y="185.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="usertask20" id="BPMNShape_usertask20">
        <omgdc:Bounds height="83.0" width="105.0" x="1527.0" y="166.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway14" id="BPMNShape_exclusivegateway14">
        <omgdc:Bounds height="40.0" width="40.0" x="1757.0" y="188.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway15" id="BPMNShape_exclusivegateway15">
        <omgdc:Bounds height="40.0" width="40.0" x="1987.0" y="188.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway16" id="BPMNShape_exclusivegateway16">
        <omgdc:Bounds height="40.0" width="40.0" x="1987.0" y="117.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent4" id="BPMNShape_endevent4">
        <omgdc:Bounds height="35.0" width="35.0" x="2072.0" y="120.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="callactivity1" id="BPMNShape_callactivity1">
        <omgdc:Bounds height="55.0" width="105.0" x="2500.0" y="110.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="155.0" y="209.0"></omgdi:waypoint>
        <omgdi:waypoint x="210.0" y="209.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
        <omgdi:waypoint x="315.0" y="209.0"></omgdi:waypoint>
        <omgdi:waypoint x="365.0" y="207.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
        <omgdi:waypoint x="470.0" y="207.0"></omgdi:waypoint>
        <omgdi:waypoint x="550.0" y="209.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow14" id="BPMNEdge_flow14">
        <omgdi:waypoint x="770.0" y="229.0"></omgdi:waypoint>
        <omgdi:waypoint x="770.0" y="280.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="39.0" width="13.0" x="10.0" y="0.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow15" id="BPMNEdge_flow15">
        <omgdi:waypoint x="790.0" y="209.0"></omgdi:waypoint>
        <omgdi:waypoint x="850.0" y="207.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="13.0" width="9.0" x="10.0" y="0.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow16" id="BPMNEdge_flow16">
        <omgdi:waypoint x="955.0" y="207.0"></omgdi:waypoint>
        <omgdi:waypoint x="995.0" y="207.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow17" id="BPMNEdge_flow17">
        <omgdi:waypoint x="1100.0" y="207.0"></omgdi:waypoint>
        <omgdi:waypoint x="1155.0" y="207.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow21" id="BPMNEdge_flow21">
        <omgdi:waypoint x="1382.0" y="227.0"></omgdi:waypoint>
        <omgdi:waypoint x="1382.0" y="292.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="13.0" width="100.0" x="10.0" y="0.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow29" id="BPMNEdge_flow29">
        <omgdi:waypoint x="2285.0" y="206.0"></omgdi:waypoint>
        <omgdi:waypoint x="2340.0" y="205.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow34" id="BPMNEdge_flow34">
        <omgdi:waypoint x="2925.0" y="205.0"></omgdi:waypoint>
        <omgdi:waypoint x="2970.0" y="205.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow35" id="BPMNEdge_flow35">
        <omgdi:waypoint x="3075.0" y="205.0"></omgdi:waypoint>
        <omgdi:waypoint x="3120.0" y="204.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow36" id="BPMNEdge_flow36">
        <omgdi:waypoint x="3225.0" y="204.0"></omgdi:waypoint>
        <omgdi:waypoint x="3300.0" y="204.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow44" id="BPMNEdge_flow44">
        <omgdi:waypoint x="2380.0" y="205.0"></omgdi:waypoint>
        <omgdi:waypoint x="2726.0" y="205.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow45" id="BPMNEdge_flow45">
        <omgdi:waypoint x="2766.0" y="205.0"></omgdi:waypoint>
        <omgdi:waypoint x="2820.0" y="205.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow46" id="BPMNEdge_flow46">
        <omgdi:waypoint x="1402.0" y="207.0"></omgdi:waypoint>
        <omgdi:waypoint x="1527.0" y="207.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="13.0" width="100.0" x="10.0" y="0.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow49" id="BPMNEdge_flow49">
        <omgdi:waypoint x="1777.0" y="188.0"></omgdi:waypoint>
        <omgdi:waypoint x="1777.0" y="137.0"></omgdi:waypoint>
        <omgdi:waypoint x="1820.0" y="137.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow51" id="BPMNEdge_flow51">
        <omgdi:waypoint x="2027.0" y="208.0"></omgdi:waypoint>
        <omgdi:waypoint x="2180.0" y="206.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow52" id="BPMNEdge_flow52">
        <omgdi:waypoint x="1797.0" y="208.0"></omgdi:waypoint>
        <omgdi:waypoint x="1987.0" y="208.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow53" id="BPMNEdge_flow53">
        <omgdi:waypoint x="666.0" y="209.0"></omgdi:waypoint>
        <omgdi:waypoint x="750.0" y="209.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow54" id="BPMNEdge_flow54">
        <omgdi:waypoint x="1260.0" y="207.0"></omgdi:waypoint>
        <omgdi:waypoint x="1362.0" y="207.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow55" id="BPMNEdge_flow55">
        <omgdi:waypoint x="1632.0" y="207.0"></omgdi:waypoint>
        <omgdi:waypoint x="1757.0" y="208.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow56" id="BPMNEdge_flow56">
        <omgdi:waypoint x="1925.0" y="137.0"></omgdi:waypoint>
        <omgdi:waypoint x="1987.0" y="137.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow57" id="BPMNEdge_flow57">
        <omgdi:waypoint x="2007.0" y="157.0"></omgdi:waypoint>
        <omgdi:waypoint x="2007.0" y="188.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow58" id="BPMNEdge_flow58">
        <omgdi:waypoint x="2027.0" y="137.0"></omgdi:waypoint>
        <omgdi:waypoint x="2072.0" y="137.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow59" id="BPMNEdge_flow59">
        <omgdi:waypoint x="2360.0" y="185.0"></omgdi:waypoint>
        <omgdi:waypoint x="2360.0" y="137.0"></omgdi:waypoint>
        <omgdi:waypoint x="2500.0" y="137.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow60" id="BPMNEdge_flow60">
        <omgdi:waypoint x="2605.0" y="137.0"></omgdi:waypoint>
        <omgdi:waypoint x="2746.0" y="137.0"></omgdi:waypoint>
        <omgdi:waypoint x="2746.0" y="185.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>